---
title: 《设计数据密集应用》读书笔记
date: 2023-08-01 10:52:00
tags: [分布式,学习笔记]
category: 分布式
---

《设计数据密集应用》分为三个部分，数据系统基础;分布式数据;衍生数据；每部分包含若干章节，本文为DDIA读书笔记，包含作者阅读记录，仅用于作者本人学习记录，如有理解歧义，误区等以原书为准。

# 数据系统基础

## 可靠性,可伸缩性和可维护性

本书开篇讲述了作为一个**计算密集形**的应用需要什么？

一个数据密集的应用程序，通常会包含若干组件，有经验的工程师通常会优先设计**数据存储方式**用于存储数据，这代表持久化。但随着技术的不断发展，某些应用也可以不使用传统的数据库实现持久化。（比如笔者见过某些应用在云原生中使用ConfigMap进行数据存储）

考虑持久化后不可避免地涉及到数据库的选型（是选择关系性还是非关系型数据库），或者是复杂查询场景下昂贵开销使得应用响应变慢，引入**缓存机制**。亦或者是为了优化用户体验，允许用户通过关键字搜索数据，过滤等，接入**搜索索引**。为了避免页面响应过长采用**异步处理**，还是为了定期处理，清洗大批量数据引入的**批处理**。

这些机制已经被**数据系统**很好抽象成为某些数据库某个特点了，但是现实中的场景往往比上述要复杂百倍，不同的数据库系统也有不同的特性。当为了实现某个复杂应用时，不得不组合使用这些工具，这还是有些难度的。

所以第一部分我们需要了解数据系统的共性与特性，及各自实现的原理。

第一章的目标就是为了弄懂：什么是可靠，可伸缩，可维护的数据系统是什么样的。



### 可靠性

人们总是希望自己使用的工具是**可靠的**，对于软件也有同样直观的想法。比如在使用一个搜索引擎，当你输入关键词后，理所应当地会对查询结果有一个心理预期，并期望它能返回符合预期的答案或结果。

同时人们总是对软件有更高的期许：希望即使不按照正常流程操作，它也不会崩溃；希望它的性能足够好，允许在一定负载下也能良好运行。

工程师们都在追求应用程序的容错性，但是绝对不能容忍因为**故障**而导致的**失效**。而故障又分为几种情况：

1.硬件故障：硬盘崩溃，内存出错，机房断电，网线磨损...这些基础的，物理的设备出现故障时给应用程序的打击几乎是毁灭的。当设备足够多时，这些情况总有一天会出现的。为了减少系统的故障率，第一反应通常都是增加单个硬件的冗余度，因为硬件的故障有可能是不可逆的，只要你能快速地把备份恢复到新机器上，故障停机时间对大多数应用而言都算不上灾难性的。只有少量高可用性至关重要的应用才会要求有多套硬件冗余。

> 对于云平台来说，灵活性和弹性是最优先的，单机可靠显得并不是那么重要。如果出现硬件故障，云平台可以快速创建出新的实例并将备份恢复到机器上，从而增强应用的可靠性。

2.软件故障：通常情况下我们认为，**系统性错误**是难以意料的，比如Linux 内核错误，比如开源组件的Bug（或彩蛋）。这种系统故障只有在异常情况下触发时才会发现，但发现时可能应用程序已经失效了。对于软件故障只能通过：测试，进程隔离，允许进程崩溃并重启（容器化），测压等方式降低它出现的几率。

3.人为错误：人为因素导致的应用程序可靠性太常见了，运维配置错误是导致服务中断的首要原因，而硬件故障（服务器或网络）仅导致了 10-25% 的服务中断。作者本人就曾在运维时误删生产环境两千条数据，人类也是不可靠的。

